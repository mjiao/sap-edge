# SPDX-FileCopyrightText: 2025 SAP edge team
# SPDX-FileContributor: Manjun Jiao (@mjiao)
#
# SPDX-License-Identifier: Apache-2.0

---
apiVersion: tekton.dev/v1
kind: PipelineRun
metadata:
  generateName: rosa-eic-validation-
  annotations:
    pipelinesascode.tekton.dev/on-event: "[pull_request]"   # only PRs
    pipelinesascode.tekton.dev/on-target-branch: "[main]"
spec:
  pipelineRef:
    name: rosa-eic-full-test-pipeline
  timeouts:
    pipeline: "240h"      # Total pipeline timeout (10 days for long validation)
    tasks: "180m"         # Individual task timeout (3 hours)
    finally: "30m"        # Finally tasks timeout
  params:
    - name: repoUrl
      value: "{{ repo_url }}"
    - name: revision
      value: "{{ revision }}"
    - name: awsRegion
      value: "eu-north-1"
    - name: clusterName
      value: "sap-eic-rosa"
    - name: rosaVersion
      value: "4.20.4"
    - name: awsSecretName
      value: "aws-credentials-secret"
    - name: redhatTokenSecretName
      value: "redhat-token-secret"
    - name: eicAuthSecretName
      value: "eic-auth-secret"
    - name: postgresAdminPasswordSecretName
      value: "rosa-postgres-admin-password"
    - name: deployPostgres
      value: "true"
    - name: deployRedis
      value: "true"
    - name: publicDNS
      value: "false"
    - name: deployQuay
      value: "true"
    - name: quayAdminPasswordSecretName
      value: "quay-admin-secret"
    - name: jiraSecretName
      value: "jira-secret-mj"
    - name: jiraIssueKey
      value: "SAPOCP-1708"
  workspaces:
    - name: source
      volumeClaimTemplate:
        spec:
          accessModes: [ReadWriteMany]
          storageClassName: ocs-storagecluster-cephfs
          resources:
            requests:
              storage: 2Gi

